var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},VisModelJS;!function(a){var b=function(){function a(){}return a.prototype.doLayout=function(){},a}();a.LayoutEngine=b;var c=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.render=function(a,b,c,d){var e=this;a.visible&&(a.shape.prepareContent(),a.shape.render(b,c,d),a.folded||a.forEachVisibleAllSubNodes(function(a){e.render(a,b,c,d)}))},b.prototype.doLayout=function(a,b){var c=document.createDocumentFragment(),d=document.createDocumentFragment(),e=document.createDocumentFragment(),f=document.createDocumentFragment();this.render(b,c,d,e),a.contentLayer.appendChild(c),a.SVGLayerConnectorGroup.appendChild(e),a.SVGLayerNodeGroup.appendChild(d),this.prepareNodeSize(b),f.appendChild(c),f.appendChild(e),f.appendChild(d),this.layout(b),a.contentLayer.appendChild(c),a.SVGLayer.appendChild(e),a.SVGLayer.appendChild(d)},b.prototype.prepareNodeSize=function(a){var b=this,c=a.shape;c.nodeWidth,c.nodeHeight,a.folded||(a.forEachVisibleLeftNodes(function(a){b.prepareNodeSize(a)}),a.forEachVisibleRightNodes(function(a){b.prepareNodeSize(a)}),a.forEachVisibleChildren(function(a){b.prepareNodeSize(a)}))},b.prototype.layout=function(a){var c=this;if(a.visible){var d=a.shape;if(!a.shouldReLayout)return void a.traverseVisibleNode(function(a){a.shape.fitSizeToContent()});a.shouldReLayout=!1,d.fitSizeToContent();var e=0,f=d.nodeWidth,g=f,h=d.nodeHeight;if(a.folded)return d.setHeadRect(0,0,f,h),void d.setTreeRect(0,0,f,h);if(null!=a.leftNodes){var i=0,j=-b.sideNodeVerticalMargin;a.forEachVisibleLeftNodes(function(a){a.shape.fitSizeToContent(),j+=b.sideNodeVerticalMargin,a.relativeX=-(a.shape.nodeWidth+b.sideNodeHorizontalMargin),a.relativeY=j,i=Math.max(i,a.shape.nodeWidth),j+=a.shape.nodeHeight});var k=(a.shape.nodeHeight-j)/2;k>0&&a.forEachVisibleLeftNodes(function(a){a.relativeY+=k}),j>0&&(e=-(i+b.sideNodeHorizontalMargin),h=Math.max(h,j))}if(null!=a.rightNodes){var l=0,m=-b.sideNodeVerticalMargin;a.forEachVisibleRightNodes(function(a){a.shape.fitSizeToContent(),m+=b.sideNodeVerticalMargin,a.relativeX=f+b.sideNodeHorizontalMargin,a.relativeY=m,l=Math.max(l,a.shape.nodeWidth),m+=a.shape.nodeHeight});var n=(a.shape.nodeHeight-m)/2;n>0&&a.forEachVisibleRightNodes(function(a){a.relativeY+=n}),m>0&&(g+=l+b.sideNodeHorizontalMargin,h=Math.max(h,m))}var o=g,p=g-e;d.setHeadRect(e,0,p,h),h+=b.childrenVerticalMargin;var q=0,r=0,s=0,t=1/0,u=[],v=0;if(null!=a.childNodes&&a.childNodes.length>0){var w=!1;a.forEachVisibleChildren(function(a){v++,c.layout(a);var d=a.shape.treeWidth,e=a.folded?a.shape.nodeWidth:a.shape.headWidth,f=a.folded?a.shape.nodeHeight:a.shape.headHeight,g=a.shape.headLeftLocalX-a.shape.treeLeftLocalX,i=g+e,j=a.shape.treeHeight,k=b.childrenHorizontalMargin,l=null==a.childNodes||0==a.childNodes.length,m=(a.folded||l)&&t>=f;if(m)a.relativeX=q,q=q+e+k,u.push(a);else{if(w){var n=q-r;if(g>n)if(a.relativeX=r,q=r+i+k,r=r+d+k,0==a.relativeX)for(var o=0;o<u.length;o++)u[o].relativeX+=g-n;else for(var p=(g-n)/(u.length+1),o=0;o<u.length;o++)u[o].relativeX+=p*(o+1);else a.relativeX=q-g,r=q+d-g+k,q=q+e+k}else{var x=Math.max(q,r);a.relativeX=x,q=x+i+k,r=x+d+k}u=[],t=f}a.relativeX+=-a.shape.treeLeftLocalX,a.relativeY=h,w=m,s=Math.max(s,j)});var x=Math.max(q,r)-b.childrenHorizontalMargin,y=(x-f)/2;1==v&&a.forEachVisibleChildren(function(c){if(y=-c.shape.treeLeftLocalX,!c.hasSideNode||c.folded){var d=0,e=c.shape.nodeHeight,f=a.shape.nodeHeight,g=b.childrenVerticalMargin;d=!c.hasChildren||f+2*g+e>h?h-(f+g):e+g,c.relativeY-=d,s-=d}}),e=Math.min(e,-y),a.forEachVisibleChildren(function(a){a.relativeX-=y}),h+=s,g=Math.max(e+x,o)}d.setTreeRect(e,0,g-e,h)}},b.sideNodeHorizontalMargin=32,b.sideNodeVerticalMargin=10,b.childrenVerticalMargin=64,b.childrenHorizontalMargin=12,b}(b);a.VerticalTreeLayoutEngine=c}(VisModelJS||(VisModelJS={}));var VisModelJS;!function(a){var b=function(){function b(){this.relativeX=0,this.relativeY=0,this.leftNodes=null,this.rightNodes=null,this.childNodes=null,this._shape=null,this._shouldReLayout=!0,this.visible=!0,this._folded=!1}return Object.defineProperty(b.prototype,"folded",{get:function(){return this._folded},set:function(a){this._folded!=a&&(this.shouldReLayout=!0),this._folded=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shouldReLayout",{get:function(){return this._shouldReLayout},set:function(a){!this._shouldReLayout&&a&&this.parent&&(this.parent.shouldReLayout=!0),this._shouldReLayout=a},enumerable:!0,configurable:!0}),b.prototype.UpdateViewMap=function(a){if(a[this.label]=this,null!=this.leftNodes)for(var b=0;b<this.leftNodes.length;b++)this.leftNodes[b].UpdateViewMap(a);if(null!=this.rightNodes)for(var b=0;b<this.rightNodes.length;b++)this.rightNodes[b].UpdateViewMap(a);if(null!=this.childNodes)for(var b=0;b<this.childNodes.length;b++)this.childNodes[b].UpdateViewMap(a)},b.prototype.appendChild=function(a){null==this.childNodes&&(this.childNodes=[]),this.childNodes.push(a),a.parent=this},b.prototype.appendLeftNode=function(a){null==this.leftNodes&&(this.leftNodes=[]),this.leftNodes.push(a),a.parent=this},b.prototype.appendRightNode=function(a){null==this.rightNodes&&(this.rightNodes=[]),this.rightNodes.push(a),a.parent=this},Object.defineProperty(b.prototype,"shape",{get:function(){return null==this._shape&&(this._shape=a.ShapeFactory.createShape(this)),this._shape},set:function(a){this._shape&&(this._shape.nodeView=null),a&&(a.nodeView=this),this._shape=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"gx",{get:function(){return null!=b.globalPositionCache&&b.globalPositionCache[this.label]?b.globalPositionCache[this.label].x:null==this.parent?this.relativeX:this.parent.gx+this.relativeX},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"gy",{get:function(){return null!=b.globalPositionCache&&b.globalPositionCache[this.label]?b.globalPositionCache[this.label].y:null==this.parent?this.relativeY:this.parent.gy+this.relativeY},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"centerGx",{get:function(){return this.gx+.5*this._shape.nodeWidth},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"centerGy",{get:function(){return this.gy+.5*this._shape.nodeHeight},enumerable:!0,configurable:!0}),b.setGlobalPositionCacheEnabled=function(a){a&&null==b.globalPositionCache?b.globalPositionCache={}:a||(b.globalPositionCache=null)},Object.defineProperty(b.prototype,"globalPosition",{get:function(){if(null!=b.globalPositionCache&&b.globalPositionCache[this.label])return b.globalPositionCache[this.label].clone();if(null==this.parent)return new a.Point(this.relativeX,this.relativeY);var c=this.parent.globalPosition;return c.x+=this.relativeX,c.y+=this.relativeY,null!=b.globalPositionCache&&(b.globalPositionCache[this.label]=c.clone()),c},enumerable:!0,configurable:!0}),b.prototype.copyFlagsFromOldView=function(a){if(a){this._folded=a._folded;var b=this.content!=a.content;b?this.shape.setColorStyle(a.shape.getColorStyle()):this.shape=a.shape}},b.prototype.getConnectorPosition=function(a,b){var c=this._shape.getConnectorPosition(a);return c.x+=b.x,c.y+=b.y,c},b.prototype.updateNodePosition=function(b,c,d,e){var f=this;if(c=c||0,this.visible){var g=function(a){var g=e;!g&&a._shape.willFadein&&(g=f),g&&c>0?(a._shape.setFadeinBasePosition(g._shape.gxCache,g._shape.gyCache),a.updateNodePosition(b,c,d,g)):a.updateNodePosition(b,c,d)},h=this.globalPosition;this._shape.moveTo(b,h.x,h.y,c,d);for(var i=[3,2,0],j=[this.childNodes,this.rightNodes,this.leftNodes],k=0;3>k;++k){var l=this.getConnectorPosition(i[k],h),m=a.reverseDirection(i[k]);this.forEachVisibleSubNode(j[k],function(e){var f=e.getConnectorPosition(m,e.globalPosition);g(e),e._shape.moveArrowTo(b,l,f,i[k],c,d),e.parentDirection=a.reverseDirection(i[k])})}}},b.prototype.forEachVisibleSubNode=function(a,b){if(null!=a&&!this._folded)for(var c=0;c<a.length;c++)if(a[c].visible&&b(a[c])===!1)return!1;return!0},b.prototype.forEachVisibleChildren=function(a){this.forEachVisibleSubNode(this.childNodes,a)},b.prototype.forEachVisibleRightNodes=function(a){this.forEachVisibleSubNode(this.rightNodes,a)},b.prototype.forEachVisibleLeftNodes=function(a){this.forEachVisibleSubNode(this.leftNodes,a)},b.prototype.forEachVisibleAllSubNodes=function(a){return this.forEachVisibleSubNode(this.leftNodes,a)&&this.forEachVisibleSubNode(this.rightNodes,a)&&this.forEachVisibleSubNode(this.childNodes,a)?!0:!1},b.prototype.traverseVisibleNode=function(a){a(this),this.forEachVisibleAllSubNodes(function(b){b.traverseVisibleNode(a)})},b.prototype.forEachSubNode=function(a,b){if(null!=a)for(var c=0;c<a.length;c++)if(b(a[c])===!1)return!1;return!0},b.prototype.forEachAllSubNodes=function(a){return this.forEachSubNode(this.leftNodes,a)&&this.forEachSubNode(this.rightNodes,a)&&this.forEachSubNode(this.childNodes,a)?!0:!1},b.prototype.traverseNode=function(a){return a(this)===!1?!1:this.forEachAllSubNodes(function(b){return b.traverseNode(a)})?!0:!1},b.prototype.clearAnimationCache=function(a){(a||!this.visible)&&this.shape.clearAnimationCache(),this.forEachAllSubNodes(a||this._folded?function(a){a.clearAnimationCache(!0)}:function(a){a.clearAnimationCache(!1)})},Object.defineProperty(b.prototype,"hasSideNode",{get:function(){return null!=this.leftNodes&&this.leftNodes.length>0||null!=this.rightNodes&&this.rightNodes.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hasChildren",{get:function(){return null!=this.childNodes&&this.childNodes.length>0},enumerable:!0,configurable:!0}),b.prototype.isInRect=function(b){var c,d=this._shape.gyCache,e=this._shape.gxCache;return c=null!=e&&null!=d?new a.Point(e,d):this.globalPosition,c.x>b.x+b.width||c.y>b.y+b.height?!1:(c.x+=this._shape.nodeWidth,c.y+=this._shape.nodeHeight,c.x<b.x||c.y<b.y?!1:!0)},b.prototype.isConnectorInRect=function(b){if(!this.parent)return!1;var c,d;null!=this._shape.gxCache&&null!=this._shape.gyCache?(c=this._shape.arrowP1Cache,d=this._shape.arrowP2Cache):(c=this.getConnectorPosition(this.parentDirection,this.globalPosition),d=this.parent.getConnectorPosition(a.reverseDirection(this.parentDirection),this.parent.globalPosition));var e=new a.Point(Math.min(c.x,d.x),Math.min(c.y,d.y));return e.x>b.x+b.width||e.y>b.y+b.height?!1:(e.x=Math.max(c.x,d.x),e.y=Math.max(c.y,d.y),e.x<b.x||e.y<b.y?!1:!0)},b.prototype.foldDeepSubGoals=function(a){0>=a?this.folded=!0:this.forEachVisibleChildren(function(b){return b.foldDeepSubGoals(a-1)})},b.globalPositionCache=null,b}();a.TreeNodeView=b}(VisModelJS||(VisModelJS={}));var VisModelJS;!function(a){var b=function(){function b(){this.queue=[],this.timerHandle=0,this.dummyDiv=document.createElement("div"),this.dummyDiv.style.position="absolute",this.dummyDiv.style.top="1000%",document.body.appendChild(this.dummyDiv)}return b.prototype.start=function(){var b=this;this.timerHandle=setInterval(function(){for(var c=a.Utils.getTime();b.queue.length>0&&a.Utils.getTime()-c<16;){var d=b.queue.shift();d.nodeView&&!d.isSizeCached&&(d.prepareContent(),d.content.parentElement||b.dummyDiv.appendChild(d.content),d.nodeWidth,d.headHeight,b.dummyDiv.removeChild(d.content))}0==b.queue.length&&(clearInterval(b.timerHandle),b.timerHandle=0)},20)},b.prototype.addShape=function(a){this.queue.push(a),this.timerHandle||this.start()},b}();a.ShapeSizePreFetcher=b;var c=function(){function a(){}return a.setFactory=function(b){a.factory=b},a.createShape=function(b){return a.factory.createShape(b)},a.prototype.createShape=function(){throw Error("Not impremented")},a}();a.ShapeFactory=c;var d=function(){function c(d){this.nodeView=d,this.colorStyles=[a.ColorStyle.Default],this._willFadein=!1,this._gxCache=null,this._gyCache=null,this.content=null,this.nodeWidthCache=c.defaultWidth,this.nodeHeightCache=0,this.headBoundingBox=new a.Rect(0,0,0,0),this.treeBoundingBox=new a.Rect(0,0,0,0),null==c.asyncSizePrefetcher&&(c.asyncSizePrefetcher=new b),c.asyncSizePrefetcher.addShape(this)}return Object.defineProperty(c.prototype,"isSizeCached",{get:function(){return 0!=this.nodeHeightCache&&0!=this.nodeWidthCache},enumerable:!0,configurable:!0}),c.createArrowPath=function(){return c.arrowPathMaster.cloneNode()},c.prototype.setTreeRect=function(a,b,c,d){this.setTreeUpperLeft(a,b),this.setTreeSize(c,d)},c.prototype.setHeadRect=function(a,b,c,d){this.setHeadUpperLeft(a,b),this.setHeadSize(c,d)},c.prototype.setTreeSize=function(a,b){this.treeBoundingBox.width=a,this.treeBoundingBox.height=b},c.prototype.setHeadSize=function(a,b){this.headBoundingBox.width=a,this.headBoundingBox.height=b},Object.defineProperty(c.prototype,"nodeWidth",{get:function(){return this.nodeWidthCache},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"nodeHeight",{get:function(){if(0==this.nodeHeightCache){var a=c.nodeHeightCache[this.content.innerHTML];a?this.nodeHeightCache=a:c.nodeHeightCache[this.content.innerHTML]=this.nodeHeightCache=this.content.clientHeight}return this.nodeHeightCache},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"treeWidth",{get:function(){return 0==this.treeBoundingBox.width&&(this.treeBoundingBox.width=150),this.treeBoundingBox.width},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"treeHeight",{get:function(){return 0==this.treeBoundingBox.height&&(this.treeBoundingBox.height=100),this.treeBoundingBox.height},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"headWidth",{get:function(){return 0==this.headBoundingBox.width&&(this.headBoundingBox.width=150),this.headBoundingBox.width},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"headHeight",{get:function(){return 0==this.headBoundingBox.height&&(this.headBoundingBox.height=100),this.headBoundingBox.height},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"treeLeftLocalX",{get:function(){return this.treeBoundingBox.x},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"headLeftLocalX",{get:function(){return this.headBoundingBox.x},enumerable:!0,configurable:!0}),c.prototype.setTreeUpperLeft=function(a,b){this.treeBoundingBox.x=a,this.treeBoundingBox.y=b},c.prototype.setHeadUpperLeft=function(a,b){this.headBoundingBox.x=a,this.headBoundingBox.y=b},c.prototype.updateHtmlClass=function(){this.content.className="node"},c.prototype.formatNewLine=function(a){return a.replace(/\r\n|\n|\r/g,"<br>")},c.prototype.prepareHTMLContent=function(){if(null==this.content){var a=document.createElement("div");if(this.content=a,a.id=this.nodeView.label,a.setAttribute("data-nodelabel",this.nodeView.label),this.nodeView.label){var b=document.createElement("h4");b.textContent=this.nodeView.label,a.appendChild(b)}if(this.nodeView.content){var c=document.createElement("p");c.innerText=this.nodeView.content.trim(),a.appendChild(c)}this.updateHtmlClass()}},c.prototype.prepareContent=function(){this.prepareHTMLContent(),this.prepareSVGContent()},c.prototype.render=function(a,b,c){b.appendChild(this.shapeGroup),null!=this.arrowPath&&null!=this.nodeView.parent&&c.appendChild(this.arrowPath),a.appendChild(this.content)},c.prototype.fitSizeToContent=function(){},c.prototype.setPosition=function(a,b){if(this.nodeView.visible){var c=this.content;null!=c&&(c.style.left=a+"px",c.style.top=b+"px");var d=this.shapeGroup.transform.baseVal.getItem(0).matrix;d.e=a,d.f=b}this._gxCache=a,this._gyCache=b},Object.defineProperty(c.prototype,"opacity",{set:function(a){this.content.style.opacity=a.toString(),this.shapeGroup.style.opacity=a.toString()},enumerable:!0,configurable:!0}),c.prototype.fadein=function(a,b){var c=this,d=1/b,e=0;a.push(function(a){e+=d*a,c.opacity=c.arrowOpacity=e})},c.prototype.moveTo=function(a,b,d,e,f){var g=this;if(0>=e)return void this.setPosition(b,d);if(this.willFadein){if(f&&(d+this.nodeHeight<f.y||d>f.y+f.height))return this.setPosition(b,d),void(this._willFadein=!1);if(this.fadein(a,e),this._willFadein=!1,null==this._gxCache||null==this._gyCache)return void this.setPosition(b,d)}if(f){if(c.__Debug_Animation_TotalNodeCount++,(this._gxCache+this.nodeWidth<f.x||this._gxCache>f.x+f.width)&&(b+this.nodeWidth<f.x||b>f.x+f.width))return void this.setPosition(b,d);if(this._gyCache+this.nodeHeight<f.y||this._gyCache>f.y+f.height)return void this.setPosition(b,d)}var h=(b-this._gxCache)/e,i=(d-this._gyCache)/e;a.push(function(a){return g.setPosition(g._gxCache+h*a,g._gyCache+i*a)})},c.prototype.setFadeinBasePosition=function(b,c){this._willFadein=!0,this._gxCache=b,this._gyCache=c,this._arrowP1Cache=this._arrowP2Cache=new a.Point(b+.5*this.nodeWidth,c+.5*this.nodeHeight)},Object.defineProperty(c.prototype,"gxCache",{get:function(){return this._gxCache},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"gyCache",{get:function(){return this._gyCache},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"willFadein",{get:function(){return this._willFadein||null==this._gxCache||null==this._gyCache},enumerable:!0,configurable:!0}),c.prototype.clearAnimationCache=function(){this._gxCache=null,this._gyCache=null},c.prototype.prepareSVGContent=function(){this.shapeGroup=a.Utils.createSVGElement("g"),this.shapeGroup.setAttribute("transform","translate(0,0)"),this.shapeGroup.setAttribute("class",this.colorStyles.join(" ")),this.arrowPath=c.createArrowPath(),this.arrowStart=this.arrowPath.pathSegList.getItem(0),this.arrowCurve=this.arrowPath.pathSegList.getItem(1)},Object.defineProperty(c.prototype,"arrowP1Cache",{get:function(){return this._arrowP1Cache},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"arrowP2Cache",{get:function(){return this._arrowP2Cache},enumerable:!0,configurable:!0}),c.prototype.setArrowPosition=function(a,b,c){var d=this.arrowStart,e=this.arrowCurve;if(d.x=a.x,d.y=a.y,e.x=b.x,e.y=b.y,3==c||1==c){var f=Math.abs(a.x-b.x);e.x1=(9*a.x+b.x)/10,e.y1=b.y,e.x2=(9*b.x+a.x)/10,e.y2=a.y,f>300&&(e.x1=a.x-10*(a.x-b.x<0?-1:1),e.x2=b.x+10*(a.x-b.x<0?-1:1)),50>f&&(e.y1=e.y2=.5*(a.y+b.y))}else e.x1=(a.x+b.x)/2,e.y1=(9*a.y+b.y)/10,e.x2=(a.x+b.x)/2,e.y2=(9*b.y+a.y)/10;this._arrowP1Cache=a,this._arrowP2Cache=b},Object.defineProperty(c.prototype,"arrowOpacity",{set:function(a){this.arrowPath.style.opacity=a.toString()},enumerable:!0,configurable:!0}),c.prototype.moveArrowTo=function(a,b,c,d,e,f){var g=this;if(0>=e)return void this.setArrowPosition(b,c,d);if(f){var h=this._arrowP1Cache.x<this._arrowP2Cache.x?this._arrowP2Cache.x:this._arrowP1Cache.x,i=this._arrowP1Cache.x<this._arrowP2Cache.x?this._arrowP1Cache.x:this._arrowP2Cache.x;if(h<f.x||i>f.x+f.width){var j=b.x<c.x?c.x:b.x,k=b.x<c.x?b.x:c.x;if(j<f.x||k>f.x+f.width)return void this.setArrowPosition(b,c,d)}if(this._arrowP2Cache.y<f.y||this._arrowP1Cache.y>f.y+f.height)return void this.setArrowPosition(b,c,d)}if(this._arrowP1Cache==this._arrowP2Cache&&f&&(c.y+this.nodeHeight<f.y||b.y>f.y+f.height))return void this.setArrowPosition(b,c,d);var l=(b.x-this._arrowP1Cache.x)/e,m=(b.y-this._arrowP1Cache.y)/e,n=(c.x-this._arrowP2Cache.x)/e,o=(c.y-this._arrowP2Cache.y)/e,p=this._arrowP1Cache.clone(),q=this._arrowP2Cache.clone();a.push(function(a){p.x+=l*a,p.y+=m*a,q.x+=n*a,q.y+=o*a,g.setArrowPosition(p,q,d)})},c.prototype.setArrowColorWhite=function(a){a?this.arrowPath.setAttribute("marker-end","url(#Triangle-white)"):this.arrowPath.setAttribute("marker-end","url(#Triangle-black)")},c.prototype.getConnectorPosition=function(b){switch(b){case 2:return new a.Point(this.nodeWidth,this.nodeHeight/2);case 0:return new a.Point(0,this.nodeHeight/2);case 1:return new a.Point(this.nodeWidth/2,0);case 3:return new a.Point(this.nodeWidth/2,this.nodeHeight);default:return new a.Point(0,0)}},c.prototype.addColorStyle=function(a){a&&(this.colorStyles.indexOf(a)<0&&this.colorStyles.push(a),this.shapeGroup&&this.shapeGroup.setAttribute("class",this.colorStyles.join(" ")))},c.prototype.removeColorStyle=function(b){if(b&&b!=a.ColorStyle.Default){var c=this.colorStyles.indexOf(b);c>0&&this.colorStyles.splice(c,1),this.shapeGroup&&this.shapeGroup.setAttribute("class",this.colorStyles.join(" "))}},c.prototype.getColorStyle=function(){return this.colorStyles},c.prototype.setColorStyle=function(b){this.colorStyles=b,this.colorStyles.indexOf(a.ColorStyle.Default)<0&&this.colorStyles.push(a.ColorStyle.Default)},c.prototype.clearColorStyle=function(){this.colorStyles=[a.ColorStyle.Default],this.shapeGroup&&this.shapeGroup.setAttribute("class",this.colorStyles.join(" "))},c.nodeHeightCache={},c.defaultWidth=150,c.arrowPathMaster=function(){var b=a.Utils.createSVGElement("path");return b.setAttribute("marker-end","url(#Triangle-black)"),b.setAttribute("fill","none"),b.setAttribute("stroke","gray"),b.setAttribute("d","M0,0 C0,0 0,0 0,0"),b}(),c}();a.Shape=d}(VisModelJS||(VisModelJS={}));var VisModelJS;!function(a){function b(a){return a+2&3}var c;!function(a){function b(a,b){var c=new Blob([a],{type:"text/plain; charset=UTF-8"});saveAs(c,b)}function c(a){for(var b=a.target||a.srcElement;null!=b;){var c=b.getAttribute("data-nodelabel");if(null!=c&&""!=c)return c;b=b.parentElement}return""}function d(a){var b=document.getElementById(a),c=b.getBoundingClientRect();return new i(c.left,c.top)}function e(a){return document.createElementNS("http://www.w3.org/2000/svg",a)}function f(a){return n.textContent=a,n.innerHTML}function g(a,b,c){if(c){var d=a,e=b||20;e=1>e?1:e;for(var f=0,g=0,h=0;h<d.length;++h){var i=d.charCodeAt(h);f+=128>i?1:2,(f>e||"\n"==d.charAt(h))&&(c(d.substr(0,h),g),"\n"==d.charAt(h)&&h++,d=d.substr(h,d.length-h),h=-1,f=0,g++)}c(d,g)}}function h(a){return a.replace(/^.+$(\r\n|\r|\n)?/m,"")}function j(){return Math.floor(2147483647*Math.random())}function k(){return j().toString(36)}function l(a){a||(a=""),window.location.hash=a}function m(a){var b=a.substring(0,1).toUpperCase()+a.substring(1);return o.isTrident()?(b="ms"+b,function(a,c){a.style[b]=c}):o.isGecko()?(b="Moz"+b,function(a,c){a.style[b]=c}):o.isWebkit()||o.isBlink()?(b="webkit"+b,function(a,c){a.style[b]=c}):function(b,c){b.style[a]=c}}a.saveStringAs=b,a.getNodeLabelFromEvent=c,a.getPositionById=d,a.createSVGElement=e;var n=document.createElement("div");a.HTMLEncode=f,a.foreachLine=g,a.removeFirstLine=h,a.generateUID=j,a.generateRandomString=k,a.updateHash=l;var o=function(){function a(){}return a.isLessThanIE6=function(){return!!a.ua.ltIE6},a.isLessThanIE7=function(){return!!a.ua.ltIE7},a.isLessThanIE8=function(){return!!a.ua.ltIE8},a.isLessThanIE9=function(){return!!a.ua.ltIE9},a.isGreaterThanIE10=function(){return!!a.ua.gtIE10},a.isTrident=function(){return!!a.ua.Trident},a.isGecko=function(){return!!a.ua.Gecko},a.isPresto=function(){return!!a.ua.Presto},a.isBlink=function(){return!!a.ua.Blink},a.isWebkit=function(){return!!a.ua.Webkit},a.isTouchEnabled=function(){return!!a.ua.Touch},a.isPointerEnabled=function(){return!!a.ua.Pointer},a.isMSPoniterEnabled=function(){return!!a.ua.MSPoniter},a.isPerformanceEnabled=function(){return!!a.ua.Performance},a.isAnimationFrameEnabled=function(){return!!a.ua.AnimationFrame},a.isTouchDevice=function(){return a.ua.Touch},a.ua=function(){return{ltIE6:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.documentElement.style.maxHeight,ltIE7:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.querySelectorAll,ltIE8:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.getElementsByClassName,ltIE9:document.uniqueID&&!window.matchMedia,gtIE10:document.uniqueID&&document.documentMode>=10,Trident:document.uniqueID,Gecko:"MozAppearance"in document.documentElement.style,Presto:window.opera,Blink:window.chrome,Webkit:!window.chrome&&"WebkitAppearance"in document.documentElement.style,Touch:"undefined"!=typeof document.ontouchstart,Mobile:"undefined"!=typeof document.orientation,Pointer:"undefined"!=typeof document.navigator&&!!document.navigator.pointerEnabled,MSPoniter:"undefined"!=typeof document.navigator&&!!document.navigator.msPointerEnabled,Performance:"undefined"!=typeof window.performance,AnimationFrame:"undefined"!=typeof window.requestAnimationFrame}}(),a}();a.UserAgant=o,a.requestAnimationFrame=o.isAnimationFrameEnabled()?window.requestAnimationFrame.bind(window):function(a){return setTimeout(a,16.7)},a.cancelAnimationFrame=o.isAnimationFrameEnabled()?window.cancelAnimationFrame.bind(window):window.clearTimeout.bind(window),a.getTime=o.isPerformanceEnabled()?performance.now.bind(performance):Date.now.bind(Date),a.setTransformOriginToElement=m("transformOrigin"),a.setTransformToElement=m("transform")}(c=a.Utils||(a.Utils={}));var d=function(){function a(){}return a.prototype.start=function(a,b){var d=this;this.cancel(),this.lastTime=this.startTime=c.getTime(),this.endTime=this.startTime+a,this.callback=b;var e=function(){var a=c.getTime(),b=a-d.lastTime;a<d.endTime?d.timerHandle=c.requestAnimationFrame(e):(b=d.endTime-d.lastTime,d.timerHandle=0),d.callback(b,a,d.startTime),d.lastTime=a};e()},a.prototype.startMany=function(a,b){b&&b.length>0&&this.start(a,function(a,c,d){for(var e=0;e<b.length;++e)b[e](a,c,d)})},a.prototype.isRunning=function(){return 0!=this.timerHandle},a.prototype.cancel=function(a){if(this.timerHandle&&(c.cancelAnimationFrame(this.timerHandle),this.timerHandle=0,a)){var b=this.endTime-this.lastTime;this.callback(b,this.endTime,this.startTime)}},a}();a.AnimationFrameTask=d;var e=function(){function a(){}return a.prototype.preventDefault=function(){this.defaultPrevented=!0},a}();a.VisModelEvent=e;var f=function(){function a(){this.Listeners={}}return a.prototype.removeEventListener=function(a,b){var c=this.Listeners[a];if(null!=c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}},a.prototype.addEventListener=function(a,b){var c=this.Listeners[a];null==c?this.Listeners[a]=[b]:-1===c.indexOf(b)&&c.unshift(b)},a.prototype.dispatchEvent=function(a){a.target=this,null!=this["on"+a.type]&&this["on"+a.type](a),null!=this["On"+a.type]&&this["On"+a.type](a);var b=this.Listeners[a.type];if(null!=b){b=b.slice(0);for(var c=0,d=b.length;d>c;c++)b[c].call(this,a)}return!a.defaultPrevented},a}();a.EventTarget=f;var g=function(){function a(){}return a.Default="node-default",a.Highlight="node-selected",a}();a.ColorStyle=g;var h=function(){function a(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d}return a.prototype.toString=function(){return"("+[this.x,this.y,this.width,this.height].join(", ")+")"},a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)},a}();a.Rect=h;var i=function(){function a(a,b){this.x=a,this.y=b}return a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.toString=function(){return"("+this.x+", "+this.y+")"},a}();a.Point=i,function(a){a[a.Left=0]="Left",a[a.Top=1]="Top",a[a.Right=2]="Right",a[a.Bottom=3]="Bottom"}(a.Direction||(a.Direction={}));a.Direction;a.reverseDirection=b}(VisModelJS||(VisModelJS={}));var VisModelJS;!function(a){var b=function(){function a(a,b,c){this.x=a,this.y=b,this.id=c}return a.prototype.setPosition=function(a,b){this.x=a,this.y=b},a}();a.Pointer=b;var c=function(){function a(){this.currentX=0,this.currentY=0,this.dx=0,this.dy=0,this.mainPointerID=null,this.pointers=[],this.timer=0,this.ANIMATE_THRESHOLD=5,this.SPEED_MAX=100,this.onDragged=function(){}}return a.prototype.startDrag=function(a,b){this.currentX=a,this.currentY=b},a.prototype.updateDrag=function(a,b){this.dx=a-this.currentX,this.dy=b-this.currentY;var c=this.dx*this.dx+this.dy+this.dy;c>this.SPEED_MAX*this.SPEED_MAX&&(this.dx*=this.SPEED_MAX*this.SPEED_MAX/c,this.dy*=this.SPEED_MAX*this.SPEED_MAX/c),this.currentX=a,this.currentY=b},a.prototype.getMainPointer=function(){return this.pointers[this.mainPointerID]},a.prototype.isDragging=function(){return null!=this.mainPointerID},a.prototype.stopAnimation=function(){clearInterval(this.timer),this.dx=0,this.dy=0},a.prototype.endDrag=function(){this.mainPointerID=null},a.prototype.onPointerEvent=function(a){var c=this;switch(a.type){case"trackstart":this.pointers[a.pointerId]||(this.pointers[a.pointerId]=new b(a.clientX,a.clientY,a.pointerId),a.preventDefault(),a.stopPropagation());break;case"trackend":if(!this.pointers[a.pointerId])return;delete this.pointers[a.pointerId],a.preventDefault(),a.stopPropagation();break;case"track":if(!this.pointers[a.pointerId])return;this.pointers[a.pointerId].setPosition(a.clientX,a.clientY),a.preventDefault(),a.stopPropagation();break;default:return}var d=Object.keys(this.pointers).length>0,e=d&&!this.isDragging(),f=!this.getMainPointer()&&this.isDragging();if(d)if(e){this.stopAnimation(),this.timer=null;var g=this.pointers[Object.keys(this.pointers)[0]];this.mainPointerID=g.id,this.startDrag(g.x,g.y)}else{var g=this.getMainPointer();g?(this.updateDrag(g.x,g.y),this.onDragged(this.dx,this.dy)):this.endDrag()}else f&&(this.timer&&(this.stopAnimation(),this.timer=null),this.timer=setInterval(function(){Math.abs(c.dx)<c.ANIMATE_THRESHOLD&&Math.abs(c.dy)<c.ANIMATE_THRESHOLD&&c.stopAnimation(),c.currentX+=c.dx,c.currentY+=c.dy,c.dx*=.95,c.dy*=.95,c.onDragged(c.dx,c.dy)},16)),this.endDrag()},a.prototype.onMouseWheel=function(a,b){b.camera.scale*=1+.02*a.deltaY},a}();a.ScrollManager=c;var d=function(b){function d(d){var e=this;b.call(this),this.panel=d,this.scrollManager=new c,this.cameraGx=0,this.cameraGy=0,this.scale=1,this.isPointerEnabled=!0,this.cameraMoveTask=new a.AnimationFrameTask;var f=this,g={get gx(){return f.cameraGx},set gx(a){var b=this;b.setPosition(a,f.cameraGy)},get gy(){return f.cameraGy},set gy(a){var b=this;b.setPosition(f.cameraGx,a)},get scale(){return f.scale},set scale(a){var b=this;f.scale=a<b.minScale?b.minScale:a>b.maxScale?b.maxScale:a,f.updateAttr()},setPosition:function(a,b){this.setOffset(f.cameraCenterPageX-a*f.scale,f.cameraCenterPageY-b*f.scale)},setPositionAndScale:function(a,b,c){f.scale=c,this.setOffset(f.cameraCenterPageX-a*f.scale,f.cameraCenterPageY-b*f.scale)},get centerPageX(){return f.cameraCenterPageX},set centerPageX(a){f.cameraCenterPageX=a},get centerPageY(){return f.cameraCenterPageY},set centerPageY(a){f.cameraCenterPageY=a},setCenterPagePosition:function(a,b){f.cameraCenterPageX=a,f.cameraCenterPageY=b},limitRect:null,move:function(a,b,c,d){this.moveTo(f.cameraGx+a,f.cameraGy+b,c,d)},moveTo:function(a,b,c,d){var e=f.createMoveToTaskFunction(a,b,c,d);return e?void this.cameraMoveTask.start(d,e):void this.setPositionAndScale(a,b,c)},setOffset:function(a,b){f.cameraGx=(f.cameraCenterPageX-a)/f.scale,f.cameraGy=(f.cameraCenterPageY-b)/f.scale,this.limitPosition(),f.updateAttr()},maxScale:2,minScale:.2,limitPosition:function(){var a=this.limitRect;a&&(f.cameraGx<a.x&&(f.cameraGx=a.x),f.cameraGy<a.y&&(f.cameraGy=a.y),f.cameraGx>a.x+a.width&&(f.cameraGx=a.x+a.width),f.cameraGy>a.y+a.height&&(f.cameraGy=a.y+a.height))},addOffset:function(a,b){f.cameraGx-=a/f.scale,f.cameraGy-=b/f.scale,this.limitPosition(),f.updateAttr()},cameraMoveTask:new a.AnimationFrameTask};this._camera=g,this.scrollManager.onDragged=g.addOffset.bind(g),window.addEventListener("resize",function(){e.updatePageRect()}),this.updatePageSize(),this.updatePageRect(),this._camera.setCenterPagePosition(this.areaCenterX,this.areaCenterY),a.Utils.setTransformOriginToElement(this.panel.contentLayer,"left top"),this.updateAttr();var h=function(a){e.isPointerEnabled&&e.scrollManager.onPointerEvent(a,e)};["trackstart","trackend","track"].forEach(function(a){PolymerGestures.addEventListener(e.panel.rootElement,a,h)});var i=function(a){e.isPointerEnabled&&(a.preventDefault(),e.scrollManager.onMouseWheel(a,e))};this.panel.rootElement.addEventListener("wheel",i)}return __extends(d,b),Object.defineProperty(d.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),d.prototype.limitScale=function(a){return a<this.camera.minScale?this.camera.minScale:a>this.camera.maxScale?this.camera.maxScale:a},Object.defineProperty(d.prototype,"offsetPageX",{get:function(){return this.cameraCenterPageX-this.cameraGx*this.scale
},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"offsetPageY",{get:function(){return this.cameraCenterPageY-this.cameraGy*this.scale},enumerable:!0,configurable:!0}),d.prototype.pageXFromGX=function(a){return this.cameraCenterPageX+(a-this.cameraGx)*this.scale},d.prototype.pageYFromGY=function(a){return this.cameraCenterPageY+(a-this.cameraGy)*this.scale},d.prototype.gxFromPageX=function(a){return(a-this.cameraCenterPageX)/this.scale+this.cameraGx},d.prototype.gyFromPageY=function(a){return(a-this.cameraCenterPageY)/this.scale+this.cameraGy},d.prototype.convertRectGlobalXYFromPageXY=function(b){var c=this.gxFromPageX(b.x),d=this.gyFromPageY(b.y),e=this.gxFromPageX(b.x+b.width),f=this.gyFromPageY(b.y+b.height);return new a.Rect(c,d,e-c,f-d)},Object.defineProperty(d.prototype,"pageRectInGxGy",{get:function(){var b=this.gxFromPageX(0),c=this.gyFromPageY(0),d=this.gxFromPageX(this._areaWidth),e=this.gyFromPageY(this._areaHeight);return new a.Rect(b,c,d-b,e-c)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"areaWidth",{get:function(){return this._areaWidth},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"areaHeight",{get:function(){return this._areaHeight},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"areaCenterX",{get:function(){return.5*this._areaWidth},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"areaCenterY",{get:function(){return.5*this._areaHeight},enumerable:!0,configurable:!0}),d.prototype.moveCamera=function(a,b,c){this.scale+=c,this.cameraGx+=a,this.cameraGy+=b,this.updateAttr()},d.prototype.createMoveTaskFunction=function(a,b,c,d){return this.createMoveToTaskFunction(this.cameraGx+a,this.cameraGy+b,c,d)},d.prototype.createMoveToTaskFunction=function(a,b,c,d){var e=this;if(c=this.limitScale(c),0>=d)return null;var f=(a-this.cameraGx)/d,g=(b-this.cameraGy)/d,h=this.scale,i=c/h,j=1/d,k=function(a){return h*Math.pow(i,a*j)};return 0==g&&0==f&&c==h?null:function(a,b,c){var d=k(b-c)-k(b-a-c);e.moveCamera(f*a,g*a,d)}},d.prototype.updatePageSize=function(){var a=this.panel.rootElement.getBoundingClientRect();this._areaWidth=a.width,this._areaHeight=a.height},d.prototype.updatePageRect=function(){{var a=this.cameraCenterPageX/this._areaWidth,b=this.cameraCenterPageY/this._areaHeight;this.pageXFromGX(this.cameraGx),this.pageYFromGY(this.cameraGy)}this.updatePageSize(),this.camera.setCenterPagePosition(this._areaWidth*a,this._areaHeight*b),this.updateAttr()},d.createTranformAttr=function(a,b,c){return"translate("+a+" "+b+") scale("+c+")"},d.createTransformStyle=function(a,b,c){return"translate("+a+"px, "+b+"px) scale("+c+") "},d.prototype.updateAttr=function(){var b=this.offsetPageX,c=this.offsetPageY;if(!isNaN(b)&&!isNaN(c)){var e=d.createTranformAttr(b,c,this.scale),f=d.createTransformStyle(b,c,this.scale);this.panel.SVGLayer.setAttribute("transform",e),a.Utils.setTransformToElement(this.panel.contentLayer,f)}var g=new a.VisModelEvent;g.type="cameramove",g.target=this,this.dispatchEvent(g)},d}(a.EventTarget);a.ViewportManager=d}(VisModelJS||(VisModelJS={}));var VisModelJS;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(a.VisModelEvent);a.NodeViewEvent=b;var c=function(c){function d(d){var e=this;if(c.call(this),this.onScreenNodeMap={},this.hiddenNodeMap={},this.foldingAnimationTask=new a.AnimationFrameTask,!d)throw new TypeError("placeHolder cannot be null.");this.rootElement=d;var f=this.rootElement.style;"static"==f.position&&(f.position="relative"),f.overflow="hidden",this.SVGLayerBox=a.Utils.createSVGElement("svg"),this.makeItLayer(this.SVGLayerBox,"100%","100%"),this.SVGLayer=a.Utils.createSVGElement("g"),this.SVGLayer.className.baseVal="vismodel-svglayer",this.SVGLayerConnectorGroup=a.Utils.createSVGElement("g"),this.SVGLayerNodeGroup=a.Utils.createSVGElement("g"),this.SVGLayer.appendChild(this.SVGLayerConnectorGroup),this.SVGLayer.appendChild(this.SVGLayerNodeGroup),this.SVGLayer.id="svg-layer",this.SVGLayer.setAttribute("transform","translate(0,0)"),this.SVGLayerBox.appendChild(this.SVGLayer),this.rootElement.appendChild(this.SVGLayerBox),this.eventMapLayer=document.createElement("div"),this.contentLayer=document.createElement("div"),this.eventMapLayer.className="vismodel-eventmaplayer",this.contentLayer.className="vismodel-contentlayer",this.makeItLayer(this.eventMapLayer,"100%","100%"),this.makeItLayer(this.contentLayer,"0px","0px"),this.contentLayer.style.pointerEvents="none",this.rootElement.appendChild(this.eventMapLayer),this.rootElement.appendChild(this.contentLayer),this.hiddenNodeBuffer=document.createDocumentFragment(),this.viewport=new a.ViewportManager(this),this.layoutEngine=new a.VerticalTreeLayoutEngine,this.viewport.addEventListener("cameramove",function(){e.updateHiddenNodeList()});var g=!1,h=!1;document.addEventListener("click",function(){g=!1,setTimeout(function(){h&&!g?h=!1:!h&&g&&(h=!0)},0)},!0),this.rootElement.addEventListener("click",function(b){var c=a.Utils.getNodeLabelFromEvent(b);e.active&&e.changeFocusedLabel(c),g=!0,b.preventDefault(),b.stopPropagation()}),this.contentLayer.addEventListener("dblclick",function(c){var d=a.Utils.getNodeLabelFromEvent(c);if(d){var f=e.viewMap[d],g=new b;g.type="dblclick",g.target=e,g.node=f,e.dispatchEvent(g),c.stopPropagation(),c.preventDefault()}}),document.addEventListener("keydown",function(a){h&&e.onKeyDown(a)},!0),this._active=!0}return __extends(d,c),d.prototype.makeItLayer=function(a,b,c){var d=a.style;d.position="absolute",d.width=b,d.height=c,d.top="0px",d.left="0px"},Object.defineProperty(d.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),d.prototype.onKeyDown=function(a){var b=!0;switch(a.keyCode){case 27:a.preventDefault();break;case 13:a.preventDefault();break;case 72:case 37:this.navigateLeft(),a.preventDefault();break;case 74:case 40:this.navigateDown(),a.preventDefault();break;case 75:case 38:var c=this.navigateUp();!c&&this._focusedLabel&&this.navigateParent(),a.preventDefault();break;case 76:case 39:this.navigateRight(),a.preventDefault();break;case 36:this.navigateHome(),a.preventDefault();break;case 187:a.shiftKey&&(this.viewport.camera.scale+=.1),a.preventDefault();break;case 189:a.shiftKey&&(this.viewport.camera.scale-=.1),a.preventDefault();break;default:b=!1}},d.prototype.onActivate=function(){this.viewport.isPointerEnabled=!0},d.prototype.onDeactivate=function(){this.viewport.isPointerEnabled=!1},d.prototype.moveToNearestNode=function(a){var b=this.findNearestNode(this.viewMap[this._focusedLabel],a);return b&&this.focusAndMoveToNode(b),!!b},d.prototype.focusAndMoveToNode=function(a){if(null!=a){var b=a.constructor==String?this.viewMap[a]:a;null!=b&&(this.changeFocusedLabel(b.label),this.viewport.camera.moveTo(b.centerGx,b.centerGy,this.viewport.camera.scale,50))}},d.prototype.findNearestNode=function(a,b){var c=1,d=1,e=1,f=1;switch(b){case 2:f=-1;break;case 0:c=-1,d=-1,e=-1;break;case 1:d=-1,e=-1,f=-1;break;case 3:c=-1}var g=null,h=1/0,i=a?a.centerGx:this.viewport.camera.gx,j=a?a.centerGy:this.viewport.camera.gy;return this.topNodeView.traverseVisibleNode(function(a){var b=a.centerGx-i,k=a.centerGy-j,l=b*c+k*d,m=b*e+k*f;if(l>0&&m>0){var n=b*b+k*k;h>n&&(h=n,g=a)}}),g},d.prototype.changeFocusedLabel=function(b){if(null==b){var c=this.viewMap[this._focusedLabel];return null!=c&&c.shape.removeColorStyle(a.ColorStyle.Highlight),void(this._focusedLabel=null)}var d=this.viewMap[b];if(null!=d){var c=this.viewMap[this._focusedLabel];null!=c&&c.shape.removeColorStyle(a.ColorStyle.Highlight),this._focusedLabel=b,d.shape.addColorStyle(a.ColorStyle.Highlight)}},Object.defineProperty(d.prototype,"focusedLabel",{get:function(){return this._focusedLabel},enumerable:!0,configurable:!0}),d.prototype.initializeView=function(a){this.topNodeView=a,this.viewMap={},this.topNodeView.UpdateViewMap(this.viewMap)},d.prototype.draw=function(b,c,d){{var e=this;a.Utils.getTime()}this.clear();var f=(a.Utils.getTime(),this.viewMap[b]);null==f&&(f=this.topNodeView);var g,h,i,j;d&&(g=d.gx,h=d.gy),this.layoutEngine.doLayout(this,f),this.contentLayer.style.display="none",this.SVGLayer.style.display="none",this.foldingAnimationTask.cancel(!0),a.TreeNodeView.setGlobalPositionCacheEnabled(!0);var k=[],l=this.viewport.pageRectInGxGy;if(d){i=d.gx-g,j=d.gy-h,i>0?l.width+=i:(l.width-=i,l.x+=i);var m=this.viewport.camera.scale,n=this.viewport.createMoveTaskFunction(i,j,m,c);k.push(n?n:function(){e.updateHiddenNodeList()})}else k.push(function(){e.updateHiddenNodeList()});a.Utils.getTime();f.updateNodePosition(k,c,l),f.clearAnimationCache();a.Utils.getTime();this.foldingAnimationTask.startMany(c,k);var o=f.shape;this.viewport.camera.limitRect=new a.Rect(o.treeLeftLocalX-100,-100,o.treeWidth+200,o.treeHeight+200),this.topNodeView.traverseVisibleNode(function(a){a.isInRect(l)?e.onScreenNodeMap[a.label]=a:(e.hiddenNodeMap[a.label]=a,e.hiddenNodeBuffer.appendChild(a.shape.content),e.hiddenNodeBuffer.appendChild(a.shape.shapeGroup))}),a.TreeNodeView.setGlobalPositionCacheEnabled(!1),this.contentLayer.style.display="",this.SVGLayer.style.display=""},d.prototype.forceAppendAllOutOfScreenNode=function(){var a=this,b=function(b){if(b.parent){var c=b.shape.arrowPath;c.parentNode!=a.hiddenNodeBuffer&&a.hiddenNodeBuffer.appendChild(c)}};for(var c in this.hiddenNodeMap){var d=this.hiddenNodeMap[c];delete this.hiddenNodeMap[c],this.onScreenNodeMap[c]=d,this.contentLayer.appendChild(d.shape.content),this.SVGLayerNodeGroup.appendChild(d.shape.shapeGroup),b(d)}},d.prototype.updateHiddenNodeList=function(){var b=this;a.TreeNodeView.setGlobalPositionCacheEnabled(!0);var c=this.viewport.pageRectInGxGy,d=function(a){if(a.parent){var d=a.shape.arrowPath;a.isConnectorInRect(c)?d.parentNode!=b.SVGLayerConnectorGroup&&b.SVGLayerConnectorGroup.appendChild(d):d.parentNode!=b.hiddenNodeBuffer&&b.hiddenNodeBuffer.appendChild(d)}};for(var e in this.onScreenNodeMap){var f=this.onScreenNodeMap[e];f.isInRect(c)||(delete this.onScreenNodeMap[e],this.hiddenNodeMap[e]=f,this.hiddenNodeBuffer.appendChild(f.shape.content),this.hiddenNodeBuffer.appendChild(f.shape.shapeGroup)),d(f)}for(var e in this.hiddenNodeMap){var f=this.hiddenNodeMap[e];f.isInRect(c)&&(delete this.hiddenNodeMap[e],this.onScreenNodeMap[e]=f,this.contentLayer.appendChild(f.shape.content),this.SVGLayerNodeGroup.appendChild(f.shape.shapeGroup)),d(f)}a.TreeNodeView.setGlobalPositionCacheEnabled(!1)},d.prototype.clear=function(){this.rootElement.style.display="none",this.contentLayer.innerHTML="",this.SVGLayer.removeChild(this.SVGLayerConnectorGroup),this.SVGLayer.removeChild(this.SVGLayerNodeGroup),this.SVGLayerConnectorGroup=a.Utils.createSVGElement("g"),this.SVGLayerNodeGroup=a.Utils.createSVGElement("g"),this.SVGLayer.appendChild(this.SVGLayerConnectorGroup),this.SVGLayer.appendChild(this.SVGLayerNodeGroup),this.hiddenNodeMap={},this.onScreenNodeMap={},this.hiddenNodeBuffer=document.createDocumentFragment(),this.rootElement.style.display=""},Object.defineProperty(d.prototype,"focusedView",{get:function(){return this.viewMap?this.viewMap[this._focusedLabel]:null},enumerable:!0,configurable:!0}),d.prototype.navigateUp=function(){return this.moveToNearestNode(1)},d.prototype.navigateDown=function(){return this.moveToNearestNode(3)},d.prototype.navigateLeft=function(){return this.moveToNearestNode(0)},d.prototype.navigateRight=function(){return this.moveToNearestNode(2)},d.prototype.navigateHome=function(){this.focusAndMoveToNode(this.topNodeView)},d.prototype.navigateParent=function(){if(this._focusedLabel){var a=this.viewMap[this._focusedLabel].parent;if(a)return void this.focusAndMoveToNode(this.viewMap[this._focusedLabel].parent)}this.focusAndMoveToNode(this.topNodeView)},d}(a.EventTarget);a.VisualModelPanel=c}(VisModelJS||(VisModelJS={}));
//# sourceMappingURL=vismodel.min.js.map